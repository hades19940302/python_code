---------------------------------------------------------------------------------------------------------------------------------------------------------UPDATE 2018-05-17	------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
镜像选择：
centos7.2-1511-20180329.raw
-------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------
修改配置文件
config.ini
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
脚本BUG
system.sh
第32行 去掉1i中i
autoDeploy.sh
第141行 注释掉iptables，没有service iptables
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
忽略所有的警告输出信息 Warning
Option "verbose" from group "DEFAULT" is deprecated for removal.  Its value may be silently ignored in the future.
/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1056: OsloDBDeprecationWarning: EngineFacade is deprecated; please use oslo_db.sqlalchemy.enginefacade
  expire_on_commit=expire_on_commit, _conf=conf)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ODPF3.0自动化部署手册中3.3.5rabbitmquser（任一节点）
第二行修改：rabbitmqctl set_permissions openstack ".*" ".*" ".*"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
控制节点Neutron授权访问
neutron port-list |grep 10.20.1.81
neutron port-update b5c75055-d03d-45d1-b6c9-360d0bd65807 --allowed-address-pair ip_address=10.20.1.220 --allowed-address-pair ip_address=10.20.1.210 --allowed-address-pair ip_address=10.20.1.200 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
网络和计算节点系统扩容
fdisk /dev/vda
partprobe 
pvcreate /dev/vda3
vgextend centos /dev/vda3
lvextend -L +10G /dev/mapper/centos-root   
xfs_growfs /dev/mapper/centos-root 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
内核升级
tar -xf linux-3.18.4.tar.xz -C /usr/src/
cd /usr/src/linux-3.18.4/
make menuconfig
make oldconfig
yum install bc
make -j 3
make modules_install install
uname -r
awk -F\' '$1=="menuentry " {print $2}' /etc/grub2.cfg
grub2-set-default 0
-------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------
创建云硬盘失败
cinder-volumes未分配空间
解决办法
fdisk /dev/vda
partprobe
pvcreate /dev/vda3
vgcreate cinder-volumes /dev/vda3
systemctl enable openstack-cinder-volume.service target.service
systemctl restart openstack-cinder-volume.service target.service
cinder service-list 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
运行autoDeploy.sh HA
/etc/yum.repos.d/
nnit-openstack.repo
运行autoDeploy.sh openstack
CentOS-Base.repo  CentOS-CR.repo  CentOS-Debuginfo.repo  CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Sources.repo  CentOS-Vault.repo  epel.repo  epel-testing.repo  nnit-openstack.repo
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
创建云主机失败
Unable to establish connection to http://127.0.0.1:9696/v2.0/extensions.json
源于计算节点安装失败，在进行网络节点和计算节点内核升级时候会自动在/etc/yum.repos.d/
生成不必要的yum源包，需要手动删除。
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
修改hostname
vi /etc/sysconfig/network
添加
HOSTNAME=
NETWORKING=yes
然后运行
hostnamectl set-hostname 
reboot
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Dashboard根目录
/usr/share/openstack-dashboard/openstack_dashboard

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
卷出现不可用或者持续回滚
cinder show +ID
cinder reset-state +ID --state available/in-use
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
检查mariadb
netstat -ntpl | grep sql
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
用户资源限制
cinder absolute-limits 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
控制直接执行openstack
没有删除、etc/yum.repos.d/多余yum源
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
简单快速复制
scp -r root@10.42.17.17:/home/centos-kernel-3.18.4-package    /home/
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
局域网yum源制作
使用 自己准备的 RPM 包 （这里以 nnit-openstack为例）
（1）、在目录 /var/www/html/ 下建立一个文件夹，把准备的 RPM包放到里面
（2）、创建仓库信息文件，在目录 /var/www/html/ 下执行：createrepo nnit-openstack
查看nnit-openstack目录，可以看到 repodate 文件已经生成
nnit-openstack yum源搭建OK
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
ps -ef |grep rabbitmq
完事了之后 把安装文件全部删除干净
脚本 安装包什么的
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ps aux | grep mysqld 
kill -s 9 +id
--------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------
服务器高并发：
yum -y install httpd-tools
ab  -n 200000  -c 3000 http://10.20.1.67/accounts/login/
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------